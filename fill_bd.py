import sys
import os
import random

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from backend.database import SessionLocal
from backend.models import Product

REAL_DATA = {
    "Food": [
        {"name": "Мраморный Стейк Рибай", "kw": "steak", "desc": "Премиальный стейк из мраморной говядины зернового откорма. Идеален для гриля."},
        {"name": "Пицца Пепперони", "kw": "pizza", "desc": "Классическая итальянская пицца с пикантной колбасой и моцареллой."},
        {"name": "Сет Роллов 'Филадельфия'", "kw": "sushi", "desc": "Свежий лосось, сливочный сыр и авокадо. 32 кусочка удовольствия."},
        {"name": "Крафтовый Бургер", "kw": "burger", "desc": "Сочная котлета, карамелизированный лук и секретный соус."},
        {"name": "Итальянская Паста", "kw": "pasta", "desc": "Паста ручной работы из твердых сортов пшеницы."},
        {"name": "Свежие Круассаны", "kw": "croissant", "desc": "Воздушные французские круассаны с шоколадной начинкой."},
        {"name": "Торт Наполеон", "kw": "cake", "desc": "Домашний торт с заварным кремом по старинному рецепту."},
        {"name": "Кофе в зернах Arabica", "kw": "coffee", "desc": "100% Арабика средней обжарки с нотками шоколада."},
        {"name": "Экзотические фрукты", "kw": "fruit", "desc": "Корзина свежих тропических фруктов: манго, ананас, маракуйя."},
        {"name": "Фермерский Сыр", "kw": "cheese", "desc": "Выдержанный твердый сыр с насыщенным ароматом."}
    ],
    "Electronics": [
        {"name": "Беспроводные наушники", "kw": "headphones", "desc": "Шумоподавление, 20 часов работы и кристально чистый звук."},
        {"name": "Смарт-часы Series 7", "kw": "smartwatch", "desc": "Мониторинг здоровья, GPS и стильный дизайн."},
    ],
    "Creativity": [
        {"name": "Набор масляных красок", "kw": "painting", "desc": "24 ярких цвета для профессиональных художников."},
        {"name": "Мольберт деревянный", "kw": "easel", "desc": "Устойчивый мольберт из бука, регулируемая высота."},
        {"name": "Скетчбук Premium", "kw": "sketchbook", "desc": "Плотная бумага, идеально подходит для маркеров и акварели."},
        {"name": "Набор для лепки", "kw": "pottery", "desc": "Глина, стеки и гончарный круг для начинающих."},
        {"name": "Профессиональные маркеры", "kw": "markers", "desc": "Двусторонние спиртовые маркеры для скетчинга."},
        {"name": "Холст на подрамнике", "kw": "canvas", "desc": "Грунтованный хлопок, 50x70 см."},
        {"name": "Набор кистей", "kw": "brushes", "desc": "Синтетика и белка, разные размеры для любых техник."},
        {"name": "Графический планшет", "kw": "tablet", "desc": "Идеален для цифрового рисования и ретуши."},
        {"name": "Акриловые краски", "kw": "acrylic", "desc": "Быстросохнущие краски с высокой укрывистостью."},
        {"name": "Набор карандашей", "kw": "pencils", "desc": "Чернографитные карандаши разной твердости."}
    ],
    "Entertainment": [
        {"name": "Кинопроектор 4K", "kw": "projector", "desc": "Домашний кинотеатр с поддержкой HDR и Smart TV."},
        {"name": "Виниловый проигрыватель", "kw": "vinyl", "desc": "Ретро-дизайн, Bluetooth и встроенные динамики."},
        {"name": "Умная колонка", "kw": "speaker", "desc": "Голосовой помощник и отличный бас."},
        {"name": "Экшн-камера", "kw": "camera", "desc": "Съемка 4K 60fps, водонепроницаемый корпус."},
        {"name": "Квадрокоптер Mini", "kw": "drone", "desc": "Легкий дрон с камерой для потрясающих аэроснимков."},
        {"name": "VR-очки", "kw": "vr", "desc": "Погружение в виртуальную реальность с контроллерами."},
        {"name": "Микрофон студийный", "kw": "microphone", "desc": "Для стримов, подкастов и записи вокала."},
        {"name": "Телевизор OLED", "kw": "tv", "desc": "Идеальный черный цвет и бесконечная контрастность."},
        {"name": "Гитара акустическая", "kw": "guitar", "desc": "Звонкий звук, корпус из красного дерева."},
        {"name": "Синтезатор", "kw": "piano", "desc": "61 клавиша, множество тембров и обучающий режим."}
    ],
    "Games": [
        {"name": "Игровая консоль Pro", "kw": "ps5", "desc": "Игры в 4K, быстрый SSD и тактильная отдача."},
        {"name": "Геймпад Wireless", "kw": "gamepad", "desc": "Эргономичный дизайн и совместимость с PC/Console."},
        {"name": "Игровое кресло", "kw": "gamingchair", "desc": "Ортопедическая спинка, RGB подсветка."},
        {"name": "Механическая клавиатура", "kw": "keyboard", "desc": "Синие свитчи, RGB и быстрый отклик."},
        {"name": "Игровая мышь", "kw": "mouse", "desc": "Высокий DPI, программируемые кнопки."},
        {"name": "Настольная игра RPG", "kw": "boardgame", "desc": "Увлекательное приключение для компании друзей."},
        {"name": "Монитор 144Hz", "kw": "monitor", "desc": "Плавная картинка для киберспорта."},
        {"name": "Гарнитура 7.1", "kw": "headset", "desc": "Объемный звук, чтобы слышать каждый шаг врага."},
        {"name": "Коврик для мыши XXL", "kw": "mousepad", "desc": "Большая поверхность для низкой сенсы."},
        {"name": "Руль для гонок", "kw": "steeringwheel", "desc": "Обратная связь по усилию, педали в комплекте."}
    ],
    "Pets": [
        {"name": "Корм Premium", "kw": "catfood", "desc": "Сбалансированный рацион для здоровья питомца."},
        {"name": "Лежанка мягкая", "kw": "dogbed", "desc": "Уютное место для сна вашего любимца."},
        {"name": "Игрушка-когтеточка", "kw": "cattoy", "desc": "Сохранит вашу мебель и развлечет кота."},
        {"name": "Поводок-рулетка", "kw": "leash", "desc": "5 метров свободы, надежный механизм."},
        {"name": "Аквариум 50л", "kw": "aquarium", "desc": "С подсветкой и фильтром для рыбок."},
        {"name": "Клетка для грызунов", "kw": "hamster", "desc": "Просторная клетка с колесом и домиком."},
        {"name": "Шампунь для собак", "kw": "dogshampoo", "desc": "Гипоаллергенный, для блестящей шерсти."},
        {"name": "Одежда для собак", "kw": "dogclothes", "desc": "Теплый комбинезон для зимних прогулок."},
        {"name": "Лакомства мясные", "kw": "dogtreats", "desc": "Натуральное сушеное мясо для дрессировки."},
        {"name": "Переноска", "kw": "petcarrier", "desc": "Удобная сумка для путешествий с животным."}
    ],
    "Beauty": [
        {"name": "Губная помада Matte", "kw": "lipstick", "desc": "Стойкий цвет и увлажнение на весь день."},
        {"name": "Палетка теней", "kw": "eyeshadow", "desc": "12 нюдовых оттенков для дневного и вечернего макияжа."},
        {"name": "Крем для лица", "kw": "facecream", "desc": "Глубокое увлажнение с гиалуроновой кислотой."},
        {"name": "Парфюм Floral", "kw": "perfume", "desc": "Нежный цветочный аромат с нотками жасмина."},
        {"name": "Тушь для ресниц", "kw": "mascara", "desc": "Объем и удлинение без комочков."},
        {"name": "Маска для лица", "kw": "facemask", "desc": "Тканевая маска для сияния кожи."},
        {"name": "Шампунь и бальзам", "kw": "shampoo", "desc": "Восстановление волос по всей длине."},
        {"name": "Кисти для макияжа", "kw": "makeupbrushes", "desc": "Набор профессиональных кистей из таклона."},
        {"name": "Скраб для тела", "kw": "scrub", "desc": "Кофейный скраб для гладкой и упругой кожи."},
        {"name": "Лак для ногтей", "kw": "nailpolish", "desc": "Гель-лак, не требует лампы, держится 7 дней."}
    ]
}

def update_products():
    db = SessionLocal()
    try:
        products = db.query(Product).all()
        print(f"Найдено {len(products)} товаров. Обновляем...")
        
        counters = {cat: 0 for cat in REAL_DATA}

        for p in products:
            if p.category in REAL_DATA:

                idx = counters[p.category] % len(REAL_DATA[p.category])
                data = REAL_DATA[p.category][idx]
                
                p.name = data["name"]
                p.description = data["desc"]
                
                p.image_url = f"https://loremflickr.com/400/400/{data['kw']}?lock={p.id}"
                
                counters[p.category] += 1
        
        db.commit()
        print("✅ Успешно! Все товары обновлены красивыми данными.")
        
    except Exception as e:
        print(f"Ошибка: {e}")
    finally:
        db.close()

if __name__ == "__main__":
    update_products()