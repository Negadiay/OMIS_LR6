#  Интеллектуальная система рекомендаций товаров и услуг (Лабораторная работа 6)

Интеллектуальная система рекомендаций товаров и услуг — полнофункциональное веб-приложение на базе FastAPI (Server-Side Rendering с Jinja2). Проект демонстрирует работу гибридной рекомендательной системы, которая адаптируется под поведение пользователя (просмотры, добавления в корзину, покупки).

<img width="1920" height="921" alt="image (20)" src="https://github.com/user-attachments/assets/e0dfea6c-3cf1-4885-93eb-16617fad532c" />


## Описание проекта

Система разработана для автоматизации процессов электронной коммерции и персонализации пользовательского опыта путём:
- Персонализированного подбора товаров на основе гибридных алгоритмов
- Адаптации выдачи в реальном времени (реакция на просмотры, добавление в корзину, покупки)
- Предоставления инструментов аналитики продаж для менеджеров
- Динамического управления весовыми коэффициентами алгоритмов рекомендаций (для администраторов)
- Полной симуляции цикла покупки: от каталога до смены статусов заказа

## Архитектура и диаграммы

Проект разработан на основе предоставленных диаграмм, которая описывает структуру системы с пользователями, основными сущностями и подсистемами, а также интерфейса. Реализация максимально следует диаграмме, с учётом особенностей Python и выбранных технологий, функционал по отсутствующим элементы описания (диаграмма состояний и макеты интерфейса администратора) был реализован самостоятельно.



## Основные модули системы

### Backend (Python/FastAPI)

#### Модели данных (`backend/models.py`)

- User Hierarchy: Полиморфная структура пользователей (User → Client, Manager, Admin)
- Commerce: Сущности электронной коммерции (Product, Cart, CartItem, Order)
- Interactions: Логирование действий пользователей (Interaction) для анализа (просмотры, добавления в корзину, покупки)
- System: Конфигурация алгоритмов (AppConfig) и отчетность (Report, SystemModule)

#### Бизнес-логика (`backend/services.py/`)

- RecommendationService: Оркестратор рекомендаций — выбирает стратегию (ML или Статистика) в зависимости от истории пользователя и агрегирует результаты
- CartService: Логика корзины — добавление товаров, обновление количества, расчет итогов и симуляция оформления заказа (checkout)
- ManagerService: Генерация аналитических отчетов по продажам для менеджеров (фильтрация по владельцу товара, подсчет выручки)

#### Алгоритмы рекомендаций (`backend/strategies.py`)

- AnalysisStrategy: Базовый абстрактный класс для всех стратегий ранжирования
- StatisticalStrategy: Стратегия "Холодного старта" — использует глобальную популярность товаров и явные интересы, указанные при регистрации, с добавлением вероятностного шума
- MLStrategy: Продвинутая стратегия — строит взвешенный вектор интересов пользователя на основе истории взаимодействий и сопоставляет его с категориями товаров (Content-Based + Global Popularity)

#### Контроллеры (`backend/controllers.py/`)

- AuthController: Регистрация (клиентов и менеджеров), вход в систему, управление сессиями (Cookies)
- ClientController: Личный кабинет, лента рекомендаций, каталог, корзина, оформление заказа, история покупок
- ManagerController: Дашборд менеджера, CRUD операции с товарами, генерация и просмотр отчетов
- AdminController: Управление системными модулями и динамическая настройка весов алгоритма рекомендаций (JSON-конфиг)

#### Слой доступа к данным (`backend/repositories.py`)

- BaseRepository: Универсальные методы CRUD (get, save, delete)
- UserRepository: Поиск пользователей по username и ID
- InteractionRepository: Выборка истории действий конкретного клиента для анализа
- CartRepository: Управление состоянием корзины клиента

#### Утилиты и инициализация 

- main.py: Точка входа приложения, настройка статики и запуск Seed-скрипта (создание дефолтных аккаунтов)
- database.py: Конфигурация подключения к SQLite и сессий SQLAlchemy
- fill_bd.py: Скрипт наполнения базы данных реалистичным контентом (названия, описания, изображения)
- run.py: Основной файл для запуска локального сервера и веб-системы

### Frontend (HTML/Jinja2)

#### Шаблоны клиента (frontend/templates/client/)

- home.html: Главная страница с персонализированной лентой рекомендаций и боковым меню категорий
- product.html: Детальная карточка товара с блоком "Похожие товары"
- cart.html: Корзина с динамическим обновлением количества и расчетом стоимости
- payment.html & result.html: Интерфейс симуляции оплаты и страница успеха
- profile.html & orders.html: Настройки профиля, интересов и история заказов с трекингом статуса
- categories.html & category_products.html: Страницы для просмотра товаров по категориям

#### Шаблоны менеджера (frontend/templates/manager/)

- cabinet.html: Дашборд с навигацией по функциям
- products_list.html & product_form.html: Таблица инвентаря и форма добавления/редактирования товаров
- reports_list.html & report_view.html: История отчетов и детальный просмотр статистики продаж

#### Шаблоны Админа (frontend/templates/admin/)
- dashboard.html: Панель управления модулями и редактор конфигурации алгоритмов

#### Общие компоненты (frontend/templates/)
- base.html: Базовый макет с адаптивным хедером (разным для ролей) и подключением стилей
- login.html: Страница входа в систему для зарегестрированных ранее пользователей 
- register.html & register_manager.html: Страница регистрации для клиента и менеджера

#### Статика (frontend/static/)
- style.css: Глобальные стили, переменные цветов, Grid/Flexbox верстка и UI компоненты


## Как работает программа

### Поток данных

1. Сбор взаимодействий: Любое значимое действие пользователя (просмотр товара, добавление в корзину, покупка) сохраняется в таблицу interactions через InteractionRepository.
2. Выбор стратегии: При загрузке главной страницы RecommendationService проверяет наличие истории у пользователя. Если истории нет — применяется StatisticalStrategy (на основе заявленных интересов). Если есть — MLStrategy.
3. Расчет весов: Алгоритм анализирует конфигурацию весов (настроенную Админом), рассчитывает скоринг для каждого товара и формирует ранжированный список List[Product].
4. Жизненный цикл заказа: Товары попадают в Cart. При checkout создается Order, создаются записи о покупке (ActionType.PURCHASE) для переобучения модели, а корзина очищается.
5. Аналитика: Менеджер инициирует генерацию отчета. ManagerService агрегирует записи о покупках, фильтрует их по manager_id товара и сохраняет снимок статистики в Report.

### Роли пользователей

- Клиент: Потребление контента (товаров), формирование истории взаимодействий, управление личным профилем и заказами. Видит персонализированную выдачу.
- Менеджер: Поставщик контента. Создает товары, управляет их описанием и ценой. Имеет доступ только к своим товарам. Анализирует продажи через отчеты.
- Администратор: Технический контроль. Может включать/отключать модули системы и влиять на логику ранжирования товаров, изменяя веса событий в реальном времени.

## Быстрый старт

1. Установите зависимости из requirements.txt:

```bash
pip install -r requirements.txt
```

2. Запустите веб-систему через run.py.
   
```bash
python run.py
```

3. Откройте браузер и перейдите и откройте http://127.0.0.1:8000:

## Предустановленные аккаунты:
При первом запуске система автоматически наполняет базу данных тестовыми данными.

Администратор:
Login: admin@market.com
Password: admin

Менеджер (с товарами):
Login: manager@market.com
Password: manager

Клиент:
Вы можете зарегистрировать нового пользователя самостоятельно.


## Структура репозитория

```
MARKET/
├─ backend/
│  ├─ config.py             # Конфигурация путей и БД
│  ├─ controllers.py        # Роутинг и обработка HTTP запросов
│  ├─ database.py           # Подключение к SQLite
│  ├─ main.py               # Точка входа и Seed-скрипт
│  ├─ models.py             # SQLAlchemy модели (ORM)
│  ├─ repositories.py       # Слой доступа к данным (CRUD)
│  ├─ services.py           # Бизнес-логика (Корзина, Отчеты)
│  └─ strategies.py         # Логика рекомендательных алгоритмов (ML/Stat)
├─ frontend/
│  ├─ static/               # CSS стили и ассеты
│  └─ templates/            # HTML шаблоны (Jinja2)
├─ fill_bd.py               # Скрипт наполнения красивыми данными
├─ run.py                   # Лаунчер приложения
└─ requirements.txt
```

## Ключевые возможности

Гибридная рекомендательная система:
- Cold Start: Для новых пользователей используется статистический анализ (популярное) + заявленные интересы.
- History Based: Для активных пользователей применяется Content-Based фильтрация на основе вектора предпочтений.

Ролевая модель:
- Клиент: Персональная лента, каталог, корзина, история заказов, профиль.
- Менеджер: CRUD товаров, генерация отчетов по продажам, аналитика выручки.
- Админ: Управление модулями системы, динамическая настройка весов алгоритма рекомендаций.
  
E-commerce функции: Честная корзина, симуляция оплаты, трекинг статуса заказа в реальном времени.

## Алгоритмы рекомендаций

Система реализует паттерн Strategy, динамически переключая алгоритмы:

- StatisticalStrategy: Используется при отсутствии истории. Рассчитывает глобальную популярность товаров + накладывает буст (вес) на категории, выбранные пользователем при регистрации. Добавлен фактор случайности ("шум") для ротации выдачи.
- MLStrategy: Строит вектор интересов пользователя на основе его действий (View=1, Cart=2.5, Purchase=5). Рекомендует товары из наиболее релевантных категорий, учитывая качество товара.

1. StatisticalStrategy (Статистическая стратегия):
- Используется при отсутствии истории действий.
- Рассчитывает глобальную популярность товаров на основе всех взаимодействий в системе.
- Накладывает "буст" (повышающий коэффициент) на категории, выбранные пользователем в интересах.
- Добавляет вероятностный шум для ротации выдачи.

2. MLStrategy (Векторный анализ):
- Строит взвешенный вектор интересов пользователя (User Vector).
- Веса действий настраиваются через админ-панель (например: Просмотр=1, Корзина=3, Покупка=5).
- Рекомендует товары из наиболее релевантных категорий, учитывая качество товара (Global Popularity).
- Фильтрует уже купленные товары.


---

## Разделы интерфейса

### 1) Вход в систему

Описание:
- Раздельные потоки регистрации для Клиентов (с выбором интересов для холодного старта рекомендаций) и Менеджеров (с указанием организации).
- Безопасная форма входа, валидация полей.

Скриншоты:

1. Вход в систему для зарегестрированных пользователей

<img width="1920" height="916" alt="image (17)" src="https://github.com/user-attachments/assets/a8ea56e5-f211-4425-9d5a-e4ffadb2f417" />

2. Регистрация клиента

<img width="1920" height="915" alt="image (18)" src="https://github.com/user-attachments/assets/f194d653-6918-44f3-97c0-edbfaba5210b" />

3. Регистрация менеджера и его организации

<img width="1920" height="916" alt="image (19)" src="https://github.com/user-attachments/assets/da9579e6-10ec-41a8-929a-6a235537218a" />


### 2) Главная страница с рекомендациями для пользователя, а также просмотр товаров по категориям

P.S. Некоторые товары могут выглядеть странно, не пугайтесь, так и должно быть. Для демонстрации работоспособности системы использовались "заглушки", при желании менеджер может в свободном порядке изменять всю информацию о своих товарах.

Описание:
- Персональные рекомендации: Лента товаров, формируемая алгоритмом на основе действий пользователя и его интересов.
- Поиск товаров по категориям и по названию, возможность положить товар в корзину не переходя на страницу товара.
- Возможность с главной страницы перейти в профиль или корзину с товарами.

Скриншоты:

1. Страница с рекомендациями пользователя
   
<img width="1920" height="921" alt="image (20)" src="https://github.com/user-attachments/assets/00627e85-6e4e-4bc2-b994-11e4fbc42156" />

2. Страница категорий (например, еда)

<img width="1920" height="916" alt="image (21)" src="https://github.com/user-attachments/assets/731776a5-1649-4d07-836b-293d754e0579" />

### 3) Страница товара 

Описание:
- Можно увидеть всю необходимую информацию о товаре: название, описание, стоимость, фотографии с разных ракурсов (стоят заглушки).
- Ниже страницы товара есть подборка похожих товаров на просматриваемый

Скриншот:

<img width="1920" height="919" alt="image (22)" src="https://github.com/user-attachments/assets/71d9a68e-8869-4245-8c9e-b9c4469bf131" />


### 4) Покупка товара 

Описание:
- На странице корзины можно просмотреть добавленные в неё товары, изменять их количество, а также увидеть предварительную сумму заказа (с учётом скидки и доставки)
- Страница оплаты предусматривает безналичную оплату по введённой карте
- После успешной оплаты товара (любая правильно введённая карта пройдет оплату, так как очевидно официальной системы оплаты нет) придёт уведомление о размещении заказа, который позже можно будет просмотреть в профиле.

Скриншоты:

1. Страница корзины с товарами
   
<img width="1920" height="914" alt="image (23)" src="https://github.com/user-attachments/assets/75055c22-7f40-4ca6-941e-e3554c3933c3" />

2. Страница оплаты и ввода данных карты
   
<img width="1920" height="913" alt="image (24)" src="https://github.com/user-attachments/assets/c5e939d1-5271-4c0c-a138-9465e02ef689" />

3. Уведомление об успешной оплате
<img width="1920" height="911" alt="image (25)" src="https://github.com/user-attachments/assets/56c5cd5a-7ad9-44ed-9c99-ebf0d1029245" />
 

### 5) Профиль клиента

Описание:
- Просмотр данных клиента, возможность их изменения.
- Возможность выйти из аккаунта.
- Просмотр истории заказов пользователя.

Скриншоты:

1. Основная страница с профилем
<img width="1920" height="918" alt="image (26)" src="https://github.com/user-attachments/assets/936e1e1a-08ab-4195-b9b6-32a361890930" />

2. История заказов
<img width="1920" height="917" alt="image (27)" src="https://github.com/user-attachments/assets/35953852-3a16-4d63-ac07-1be1382d345c" />


### 6) Окна менеджера 

Описание:
- Менеджер может просматривать список размещённых им товаров.
- Можно пополнить ассортимент, добавив новый товар, разместив всю необходимую информацию о нём.
- Есть возможность создать отчёт по проданным товарам: название, количество проданных единиц, прибыль с него.
- Присутствует возможность посмотреть имеющиеся отчёты, а также изменять/удалять их.

Скриншоты:

1. Главная страница менеджера
<img width="1920" height="917" alt="image (28)" src="https://github.com/user-attachments/assets/15f08468-84d8-4743-8cf5-e075781785d4" />

2. Список товаров
<img width="1920" height="915" alt="image (29)" src="https://github.com/user-attachments/assets/664754d2-5aa6-4875-a161-95ccac2aa6ce" />

3. Добавление товара и информации о нём
<img width="1920" height="916" alt="image (30)" src="https://github.com/user-attachments/assets/2f4ea4ce-c662-45b5-a0ef-c861ba954e55" />

4. Отчёт
<img width="1920" height="916" alt="image (32)" src="https://github.com/user-attachments/assets/b1d90b62-acb8-4e02-8be6-a0a0df1bde78" />

5. История отчётов
<img width="1920" height="914" alt="image (33)" src="https://github.com/user-attachments/assets/b8a72551-682d-48a9-b3f5-7b968ec2e872" />


### 7) Администратор

Описание:
- Управление модулями системы.
- Algorithm Config: Редактор JSON для "горячей" настройки весов рекомендательного алгоритма (просмотры, добавление в корзину, покупки) без перезагрузки сервера.

Скриншот:

<img width="1920" height="917" alt="image (34)" src="https://github.com/user-attachments/assets/7bf4d830-a742-4c76-a9c2-29c7d24c5059" />

---

## Используемые технологии

- Python 3.10+ - основной ЯП
- FastAPI - веб-фреймворк
- SQLAlchemy - для работы с базой данных
- SQLite - база данных
- CSS (Flexbox/Grid) - язык разметки
- jinja2 - для HTML
- python-multipart - приём форм и файлов
- pydantic - валидация данных

## Roadmap / Что можно добавить

- Внедрение сервиса «Онлайн-примерка» с использованием технологии дополненной реальности (AR). Пользователь сможет через камеру смартфона или веб-камеру "примерить" одежду, обувь или аксессуары в реальном времени, а также создать виртуальный аватар со своими параметрами для точного подбора размера и стиля.
- Развитие функции «Секретная подборка от друзей» — интеграция с соцсетями (с согласия пользователя) для показа товаров, которые рекомендуют или покупают его друзья, создавая эффект доверия и вовлеченности.
- Разработка голосового интерфейса для получения рекомендаций через интеграцию с популярными ассистентами (Алиса, Siri), позволяющего пользователям голосом запрашивать подбор товаров и получать озвученные ответы.
